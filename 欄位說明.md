# Excel 欄位說明

## 重要說明

✅ **系統支援包含額外欄位的 Excel 檔案**

您的 Excel 檔案可以包含任意數量的欄位，系統會自動提取需要的欄位，忽略其他欄位。

---

## 必要欄位

系統需要以下欄位（欄位名稱必須完全一致）：

| 欄位名稱 | 說明 | 是否必填 |
|---------|------|---------|
| 兒童姓名 | 參加活動的兒童姓名 | ⚠️ 建議填寫 |
| 性別 | 兒童性別 | ⚠️ 建議填寫 |
| 年級 | 兒童就讀年級 | ✅ **必填**（用於分組） |
| 學校 | 就讀學校名稱 | ⚠️ 建議填寫 |
| 家長姓名 | 家長或監護人姓名 | ✅ **必填**（用於判斷手足） |
| 家長行動電話 | 聯絡電話 | ⚠️ 建議填寫 |

### 選填欄位

| 欄位名稱 | 說明 |
|---------|------|
| 報名序號 | 報名的流水號（如果有的話） |
| 備註 | 其他備註資訊 |

---

## 額外欄位處理

### ✅ 系統會自動忽略的欄位

您的 Excel 可以包含任何額外的欄位，例如：
- 報名日期
- 繳費狀態
- 身分證字號
- 出生日期
- 緊急聯絡人
- 過敏資訊
- 特殊需求
- 內部編號
- 等等...

**這些欄位不會影響系統處理，系統只會提取需要的欄位。**

### 範例

假設您的 Excel 有以下欄位：

```
報名日期 | 報名序號 | 兒童姓名 | 性別 | 年級 | 學校 | 身分證字號 | 出生日期 | 家長姓名 | 家長行動電話 | 緊急聯絡人 | 繳費狀態 | 備註
```

系統會：
1. ✅ 提取：報名序號、兒童姓名、性別、年級、學校、家長姓名、家長行動電話、備註
2. ⏭️ 忽略：報名日期、身分證字號、出生日期、緊急聯絡人、繳費狀態

---

## 欄位名稱要求

### ✅ 正確的欄位名稱

```
兒童姓名
性別
年級
學校
家長姓名
家長行動電話
```

### ❌ 錯誤的欄位名稱

```
小朋友姓名    ❌ (應該是「兒童姓名」)
學生姓名      ❌ (應該是「兒童姓名」)
孩子姓名      ❌ (應該是「兒童姓名」)
年級別        ❌ (應該是「年級」)
就讀年級      ❌ (應該是「年級」)
家長名字      ❌ (應該是「家長姓名」)
家長電話      ❌ (應該是「家長行動電話」)
手機          ❌ (應該是「家長行動電話」)
```

### 注意事項

1. **欄位名稱必須完全一致**
2. **系統會自動清理換行符**：如果欄位名稱中有換行符（例如「家長\n姓名」），系統會自動清理成「家長姓名」
3. **系統會自動清理多餘空格**：前後的空格會被自動移除

---

## 系統處理流程

### 1. 讀取 Excel

系統會讀取第一個工作表的所有資料

### 2. 檢查欄位

系統會自動檢查並顯示：
- ✅ Excel 中有哪些欄位
- ⚠️ 缺少哪些必要欄位

### 3. 提取資料

系統只提取需要的欄位，忽略其他欄位

### 4. 處理資料

- 依「年級」分組
- 依「家長姓名」判斷手足關係
- 加入手足資訊

### 5. 輸出結果

每個年級一個分頁，包含整理後的資料

---

## 常見問題

### Q1: 我的 Excel 有很多額外欄位，需要刪除嗎？

**A**: ❌ 不需要！系統會自動忽略額外的欄位，只提取需要的資料。

### Q2: 如果缺少某些欄位會怎樣？

**A**: 系統會顯示警告訊息，但仍會繼續處理。缺少的欄位會顯示為空值。

例如：
- 缺少「報名序號」→ 該欄位會是空的
- 缺少「備註」→ 該欄位會是空的
- 缺少「年級」→ 資料會被歸類到「未分類」分頁
- 缺少「家長姓名」→ 無法判斷手足關係

### Q3: 欄位順序重要嗎？

**A**: ❌ 不重要！欄位可以是任何順序，系統會依照欄位名稱來識別。

例如，以下兩種順序都可以：

**順序 1:**
```
報名序號 | 兒童姓名 | 性別 | 年級 | 學校 | 家長姓名 | 家長行動電話
```

**順序 2:**
```
家長姓名 | 家長行動電話 | 兒童姓名 | 年級 | 性別 | 學校 | 報名序號
```

### Q4: 可以有多個工作表嗎？

**A**: 系統只會讀取第一個工作表，其他工作表會被忽略。

### Q5: 欄位名稱可以修改嗎？

**A**: 如果您的 Excel 使用不同的欄位名稱，有兩個選擇：

1. **修改 Excel**（推薦）：將欄位名稱改成系統要求的名稱
2. **修改程式碼**：修改 `backend/src/services/excelService.js` 中的欄位對應

---

## 錯誤訊息說明

### 「Excel 檔案中沒有資料」

**原因**: Excel 檔案是空的或第一個工作表沒有資料

**解決方法**: 
- 確認 Excel 有資料
- 確認資料在第一個工作表

### 「警告：缺少以下欄位」

**原因**: Excel 缺少某些建議的欄位

**解決方法**: 
- 這只是警告，系統仍會繼續處理
- 如果需要這些欄位，請在 Excel 中加入

### 「Excel 檔案格式錯誤」

**原因**: 檔案可能損壞或不是有效的 Excel 格式

**解決方法**:
- 確認檔案是 .xlsx 或 .xls 格式
- 嘗試重新儲存 Excel 檔案
- 確認檔案沒有損壞

---

## 測試建議

### 第一次使用

建議先用簡單的測試資料：

1. 建立一個只包含必要欄位的 Excel
2. 上傳並測試
3. 確認結果正確

### 正式使用

確認測試成功後：

1. 使用您的完整 Excel 檔案（包含所有欄位）
2. 系統會自動提取需要的欄位
3. 檢查輸出結果

---

## 後端日誌

當您上傳檔案時，後端會顯示詳細的日誌：

```
讀取到 50 筆資料
Excel 中的欄位: ['報名日期', '報名序號', '兒童姓名', '性別', '年級', '學校', '身分證字號', '家長姓名', '家長行動電話', '繳費狀態', '備註']
警告：缺少以下欄位: []
建立分頁: 一年級, 共 15 筆資料
建立分頁: 二年級, 共 18 筆資料
建立分頁: 三年級, 共 17 筆資料
處理完成
```

這可以幫助您了解系統如何處理您的資料。

---

## 總結

✅ **系統非常靈活**
- 支援任意數量的欄位
- 自動提取需要的資料
- 忽略不需要的欄位

✅ **只需確保**
- 必要欄位的名稱正確
- 資料在第一個工作表
- 檔案格式是 .xlsx 或 .xls

✅ **不需要擔心**
- 額外的欄位
- 欄位的順序
- 其他工作表

如有任何問題，請查看後端終端機的日誌訊息！
