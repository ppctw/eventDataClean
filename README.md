# 活動報名 Excel 整理系統

## 系統說明

這是一個可以自動整理活動報名 Excel 檔案的系統，主要功能包括：

- 上傳包含報名資料的 Excel 檔案
- 建立「總表」分頁，彙整所有資料並依報名序號排序
- 依照「年級」自動分組，每個年級建立一個分頁
- 自動判斷手足關係（依據家長姓名）
- 輸出整理後的 Excel 檔案供下載

### ✨ 重要特色

- ✅ **支援包含額外欄位的 Excel**：您的 Excel 可以有任意數量的欄位，系統會自動提取需要的欄位
- ✅ **欄位順序不重要**：欄位可以是任何順序
- ✅ **自動檢查欄位**：系統會顯示可用的欄位和缺少的欄位
- ✅ **詳細的錯誤訊息**：如果有問題，系統會告訴您具體原因

## 技術架構

- **前端**: React + TypeScript + Vite
- **後端**: Node.js + Express
- **Excel 處理**: xlsx 套件

## 專案結構

```
eventCheckIn_ppc/
├── backend/              # 後端程式碼
│   ├── src/
│   │   ├── server.js    # 主程式
│   │   ├── routes/      # API 路由
│   │   └── services/    # 業務邏輯
│   ├── uploads/         # 暫存上傳檔案
│   └── package.json
├── frontend/            # 前端程式碼
│   ├── src/
│   │   ├── App.tsx      # 主元件
│   │   ├── api/         # API 呼叫
│   │   └── components/  # React 元件
│   └── package.json
└── README.md
```

## 安裝與啟動

### 1. 安裝後端依賴

```bash
cd backend
npm install
```

### 2. 啟動後端服務

```bash
npm run dev
```

後端將在 `http://localhost:3001` 啟動

### 3. 安裝前端依賴

```bash
cd frontend
npm install
```

### 4. 啟動前端服務

```bash
npm run dev
```

前端將在 `http://localhost:5173` 啟動

## 使用方式

1. 開啟瀏覽器訪問 `http://localhost:5173`
2. 點擊「選擇檔案」上傳 Excel 檔案（.xlsx 或 .xls）
3. 點擊「上傳並處理」按鈕
4. 等待處理完成後，點擊「下載整理後的 Excel」

## 資料處理邏輯

### 輸入欄位（原始 Excel）

- 報名序號
- 兒童姓名
- 性別
- 年級
- 學校
- 家長姓名
- 家長行動電話
- 備註

### 輸出欄位（整理後的 Excel）

每個年級會建立一個獨立的分頁，包含以下欄位：

1. **項次**: 該年級內的流水號（從 1 開始）
2. **報名序號**: 原始報名序號
3. **兒童姓名**: 兒童姓名
4. **性別**: 性別
5. **年級**: 年級
6. **學校**: 學校名稱
7. **手足名稱**: 同一家長的其他孩子姓名（逗號分隔）
8. **手足性別**: 手足的性別（逗號分隔）
9. **手足年級**: 手足的年級（逗號分隔）
10. **家長姓名**: 家長姓名
11. **家長行動電話**: 家長電話
12. **備註**: 備註資訊

### 手足判斷邏輯

- 以「家長姓名」作為同一戶家庭的判斷依據
- 同一個家長姓名下的其他孩子，視為該孩子的手足
- 手足資訊會以逗號分隔的方式呈現

## 如何新增欄位

如果未來需要新增欄位（例如：學校電話），需要修改以下檔案：

1. **後端處理邏輯**: `backend/src/services/excelService.js`
   - 在 `processExcelData` 函數中，將新欄位加入輸出陣列

2. **欄位對應**: 確保原始 Excel 中有對應的欄位名稱

範例：
```javascript
// 在 excelService.js 中
row.push(
  item['報名序號'],
  item['兒童姓名'],
  // ... 其他欄位
  item['學校電話'], // 新增欄位
  item['備註']
);
```

## 注意事項

- Excel 檔案必須包含所需的欄位（報名序號、兒童姓名、性別、年級、學校、家長姓名、家長行動電話）
- 年級欄位為空的資料會被歸類到「未分類」分頁
- 家長姓名為空的資料無法判斷手足關係
- 上傳的檔案會暫存在後端，處理完成後會自動清除

## 授權

MIT License
