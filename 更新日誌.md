# 更新日誌

## v1.2.1 (2024-11-25)

### 🎉 新功能

#### 總表手足資料展開
- ✅ 將手足資料從「逗號分隔」展開成「多列」
- ✅ 每個手足佔一列，包含：手足名稱、手足性別、手足年級
- ✅ 同一戶（同一家長）的資料會連續列出
- ✅ 項次自動遞增，包括展開的手足列

#### 範例
**之前（v1.2.0）**：
```
項次 | 報名序號 | 兒童姓名 | 手足名稱      | 手足性別 | 手足年級
1    | 022      | 溫河     | 溫新, 溫柔知  | 男, 女   | 二年級, 大班
```

**現在（v1.2.1）**：
```
項次 | 報名序號 | 兒童姓名 | 手足名稱 | 手足性別 | 手足年級
1    | 022      | 溫河     | 溫新     | 男       | 二年級
2    | 022      | 溫河     | 溫柔知   | 女       | 大班
```

---

## v1.2.0 (2024-11-25)

### 🎉 新功能

#### 新增「總表」分頁
- ✅ 自動建立「總表」分頁，放在第一個位置
- ✅ 彙整所有年級的學生資料
- ✅ 依報名序號進行正排序（由小到大）
- ✅ 重新編號項次（從 1 開始）

### 📝 輸出結構變更

**之前**：
```
1. 一年級
2. 二年級
3. 三年級
...
```

**現在**：
```
1. 總表      ← 新增！所有資料依報名序號排序
2. 一年級
3. 二年級
4. 三年級
...
```

### 🔧 技術改進

#### 後端修改
- 修改 `processExcelData()` 函數，回傳 `{ gradeSheets, allStudents }`
- 新增 `createSummarySheet()` 函數，處理總表的建立和排序
- 更新主流程，先建立總表再建立年級分頁

#### 排序邏輯
```javascript
// 將報名序號轉換為數字並排序
const sortedStudents = [...allStudents].sort((a, b) => {
  const numA = parseInt(a.報名序號) || 0;
  const numB = parseInt(b.報名序號) || 0;
  return numA - numB;
});
```

### 📚 文件更新
- ✅ 更新 `README.md`，說明總表功能
- ✅ 新增 `總表功能說明.md`，詳細說明總表的使用方式
- ✅ 新增 `更新日誌.md`（本文件）

---

## v1.1.0 (2024-11-25)

### 🐛 錯誤修復

#### 1. 前端錯誤訊息顯示
- **問題**：前端只顯示空的錯誤物件 `{}`
- **修復**：加入 Blob 錯誤訊息解析邏輯
- **檔案**：`frontend/src/api/uploadApi.ts`

#### 2. HTTP Header 中文字元錯誤
- **問題**：`ERR_INVALID_CHAR` 錯誤
- **修復**：使用 RFC 5987 編碼處理中文檔名
- **檔案**：`backend/src/routes/uploadRoutes.js`

#### 3. Excel 欄位名稱包含換行符
- **問題**：欄位名稱如 `'家長\r\n姓名'` 無法識別
- **修復**：自動清理欄位名稱中的換行符和空格
- **檔案**：`backend/src/services/excelService.js`

### 📚 文件新增
- ✅ 新增 `欄位說明.md`
- ✅ 新增 `快速參考.md`
- ✅ 新增 `問題修復記錄.md`

---

## v1.0.0 (2024-11-24)

### 🎉 初始版本

#### 核心功能
- ✅ Excel 檔案上傳
- ✅ 依年級自動分組
- ✅ 自動判斷手足關係（依家長姓名）
- ✅ 輸出整理後的 Excel 檔案

#### 技術架構
- **前端**：React + TypeScript + Vite
- **後端**：Node.js + Express
- **Excel 處理**：xlsx 套件

#### 主要功能
1. **檔案上傳**
   - 支援 .xlsx 和 .xls 格式
   - 檔案大小限制 10MB
   - 即時上傳進度顯示

2. **資料處理**
   - 讀取 Excel 第一個工作表
   - 依「年級」欄位分組
   - 依「家長姓名」判斷手足關係
   - 每個年級建立獨立分頁

3. **輸出格式**
   - 項次（每個年級從 1 開始）
   - 報名序號
   - 兒童姓名
   - 性別
   - 年級
   - 學校
   - 手足名稱（新增）
   - 手足性別（新增）
   - 手足年級（新增）
   - 家長姓名
   - 家長行動電話
   - 備註

#### 文件系統
- ✅ `README.md` - 專案主要說明
- ✅ `QUICKSTART.md` - 快速啟動指南
- ✅ `EXAMPLE_DATA.md` - Excel 範例資料格式
- ✅ `SYSTEM_FLOW.md` - 系統流程說明
- ✅ `PROJECT_OVERVIEW.md` - 專案總覽
- ✅ `IMPLEMENTATION_SUMMARY.md` - 實作總結
- ✅ `測試資料說明.md` - 測試資料建立指南
- ✅ `啟動檢查清單.md` - 系統啟動檢查清單

#### 開發工具
- ✅ `.gitignore` 配置
- ✅ `start.sh` 快速啟動腳本
- ✅ ESLint 配置
- ✅ TypeScript 配置

---

## 版本規則

版本號格式：`主版本.次版本.修訂版本`

- **主版本**：重大功能變更或不相容的 API 修改
- **次版本**：新增功能，向下相容
- **修訂版本**：錯誤修復，向下相容

---

## 未來計劃

### v1.3.0（規劃中）
- [ ] 支援多個 Excel 檔案批次處理
- [ ] 前端預覽功能（上傳前顯示欄位）
- [ ] 自訂欄位對應功能
- [ ] 匯出 PDF 格式

### v1.4.0（規劃中）
- [ ] 資料驗證功能（檢查必填欄位）
- [ ] 重複資料檢測
- [ ] 資料統計報表
- [ ] 匯出 CSV 格式

### v2.0.0（規劃中）
- [ ] 資料庫儲存功能
- [ ] 使用者帳號系統
- [ ] 歷史記錄查詢
- [ ] API 文件

---

## 貢獻者

- **開發者**：Cascade AI
- **需求提供**：Jo

---

## 授權

MIT License

---

## 聯絡方式

如有問題或建議，請查看相關文件或提出 Issue。
